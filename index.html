<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NAPLAN Year 3 å•è¯å­¦ä¹ </title>
<style>
:root{--bg:#f0f4f8;--card:#fff;--primary:#3b82f6;--primary-dark:#2563eb;--success:#22c55e;--danger:#ef4444;--warning:#f59e0b;--text:#1e293b;--muted:#64748b;--border:#e2e8f0;--radius:16px}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:var(--bg);color:var(--text);min-height:100vh}

/* Header */
.header{background:linear-gradient(135deg,#1e40af 0%,#7c3aed 50%,#db2777 100%);color:#fff;padding:20px;text-align:center}
.header h1{font-size:1.5rem;font-weight:800}
.header p{font-size:0.85rem;opacity:0.9;margin-top:4px}

/* Stats bar */
.stats-bar{display:flex;justify-content:center;gap:16px;padding:12px;background:#fff;border-bottom:1px solid var(--border);flex-wrap:wrap}
.stat{text-align:center;min-width:70px}
.stat-num{font-size:1.3rem;font-weight:800;color:var(--primary)}
.stat-num.green{color:var(--success)}
.stat-num.orange{color:var(--warning)}
.stat-label{font-size:0.7rem;color:var(--muted)}

/* Nav */
.nav{display:flex;justify-content:center;gap:8px;padding:12px;background:#fff;border-bottom:1px solid var(--border)}
.nav button{padding:8px 20px;border:2px solid var(--border);border-radius:99px;background:#fff;font-size:0.85rem;font-weight:600;cursor:pointer;transition:all .15s}
.nav button.active{background:var(--primary);color:#fff;border-color:var(--primary)}
.nav button:hover:not(.active){border-color:var(--primary);color:var(--primary)}

/* Main */
.container{max-width:600px;margin:0 auto;padding:20px}

/* Card */
.card{background:var(--card);border-radius:var(--radius);padding:32px 24px;box-shadow:0 4px 24px rgba(0,0,0,0.08);text-align:center;margin-bottom:20px}
.card h2{font-size:1.1rem;color:var(--muted);margin-bottom:8px}

/* Spelling mode */
.word-chinese{font-size:2rem;font-weight:800;margin:16px 0;color:var(--text)}
.word-hint{font-size:0.9rem;color:var(--muted);margin-bottom:16px}
.input-row{display:flex;gap:8px;justify-content:center;margin:16px 0}
.input-row input{font-size:1.3rem;padding:12px 16px;border:2px solid var(--border);border-radius:12px;width:260px;text-align:center;outline:none;transition:border-color .15s}
.input-row input:focus{border-color:var(--primary)}
.input-row input.correct{border-color:var(--success);background:#f0fdf4}
.input-row input.wrong{border-color:var(--danger);background:#fef2f2}

/* Quiz mode */
.quiz-word{font-size:2.2rem;font-weight:800;margin:16px 0;color:var(--primary)}
.options{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:16px 0}
.option{padding:14px 16px;border:2px solid var(--border);border-radius:12px;background:#fff;font-size:1rem;cursor:pointer;transition:all .15s;text-align:center}
.option:hover{border-color:var(--primary);background:var(--primary);color:#fff;transform:scale(1.02)}
.option.correct{border-color:var(--success);background:#f0fdf4;color:var(--success)}
.option.wrong{border-color:var(--danger);background:#fef2f2;color:var(--danger)}
.option.disabled{pointer-events:none}

/* Feedback */
.feedback{font-size:1.2rem;font-weight:700;margin:12px 0;min-height:36px}
.feedback.correct{color:var(--success)}
.feedback.wrong{color:var(--danger)}

/* Buttons */
.btn{padding:12px 28px;border:none;border-radius:12px;font-size:1rem;font-weight:700;cursor:pointer;transition:all .15s}
.btn-primary{background:var(--primary);color:#fff}
.btn-primary:hover{background:var(--primary-dark)}
.btn-success{background:var(--success);color:#fff}
.btn-danger{background:var(--danger);color:#fff}
.btn-outline{background:#fff;border:2px solid var(--border);color:var(--text)}
.btn-outline:hover{border-color:var(--primary)}
.btn-small{padding:8px 16px;font-size:0.85rem}

/* Progress bar */
.progress-bar{width:100%;height:8px;background:var(--border);border-radius:99px;margin:12px 0;overflow:hidden}
.progress-fill{height:100%;background:linear-gradient(90deg,var(--primary),var(--success));border-radius:99px;transition:width .3s}

/* Word list */
.word-list{max-height:400px;overflow-y:auto;text-align:left}
.word-item{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;border-bottom:1px solid var(--border);font-size:0.9rem}
.word-item .eng{font-weight:600}
.word-item .chn{color:var(--muted)}
.word-item .badge{font-size:0.7rem;padding:2px 8px;border-radius:99px;font-weight:700}
.badge-mastered{background:#dcfce7;color:#16a34a}
.badge-learning{background:#fef3c7;color:#d97706}
.badge-new{background:#e0e7ff;color:#4f46e5}

/* Filter tabs */
.filter-tabs{display:flex;gap:6px;margin-bottom:12px;flex-wrap:wrap}
.filter-tab{padding:6px 14px;border-radius:99px;border:1px solid var(--border);font-size:0.8rem;cursor:pointer;background:#fff}
.filter-tab.active{background:var(--primary);color:#fff;border-color:var(--primary)}

/* Reveal */
.reveal-area{margin:12px 0;min-height:40px}
.reveal-word{font-size:1.5rem;font-weight:800;color:var(--danger)}

/* Reset */
.reset-section{margin-top:20px;padding-top:16px;border-top:1px solid var(--border)}

/* Letters */
.letter-hint{font-size:1rem;color:var(--muted);letter-spacing:4px;margin:8px 0;font-family:monospace}

/* Responsive */
@media(max-width:480px){
  .options{grid-template-columns:1fr}
  .input-row input{width:200px;font-size:1.1rem}
  .word-chinese{font-size:1.6rem}
  .quiz-word{font-size:1.8rem}
}
</style>
</head>
<body>

<div class="header">
  <h1>ğŸ“š NAPLAN Year 3 å•è¯å­¦ä¹ </h1>
  <p>æ‹¼å†™ + è¯ä¹‰é€‰æ‹© Â· é—´éš”é‡å¤ Â· å­¦åˆ°ä¼šä¸ºæ­¢</p>
</div>

<div class="stats-bar">
  <div class="stat"><div class="stat-num green" id="s-mastered">0</div><div class="stat-label">å·²æŒæ¡ âœ…</div></div>
  <div class="stat"><div class="stat-num orange" id="s-learning">0</div><div class="stat-label">å­¦ä¹ ä¸­ ğŸ“</div></div>
  <div class="stat"><div class="stat-num" id="s-new">0</div><div class="stat-label">å¾…å­¦ä¹  ğŸ†•</div></div>
  <div class="stat"><div class="stat-num" id="s-total">0</div><div class="stat-label">æ€»è®¡</div></div>
</div>

<div class="nav">
  <button class="active" onclick="switchMode('spell')">âœï¸ æ‹¼å†™</button>
  <button onclick="switchMode('quiz')">ğŸ¯ è¯ä¹‰</button>
  <button onclick="switchMode('list')">ğŸ“‹ è¯è¡¨</button>
</div>

<div class="container">
  <!-- Spelling Mode -->
  <div id="mode-spell">
    <div class="card">
      <h2>çœ‹ä¸­æ–‡ï¼Œæ‹¼è‹±æ–‡ âœï¸</h2>
      <div class="word-chinese" id="spell-chinese"></div>
      <div class="letter-hint" id="spell-hint"></div>
      <div class="input-row">
        <input type="text" id="spell-input" placeholder="è¾“å…¥è‹±æ–‡å•è¯..." autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false">
      </div>
      <div class="feedback" id="spell-feedback"></div>
      <div class="reveal-area" id="spell-reveal"></div>
      <div style="display:flex;gap:8px;justify-content:center;flex-wrap:wrap">
        <button class="btn btn-primary" onclick="checkSpelling()">æ£€æŸ¥ âœ“</button>
        <button class="btn btn-outline" onclick="showHint()">æç¤º ğŸ’¡</button>
        <button class="btn btn-outline" onclick="revealAnswer()">çœ‹ç­”æ¡ˆ ğŸ‘€</button>
        <button class="btn btn-success" onclick="nextWord()">ä¸‹ä¸€ä¸ª â†’</button>
      </div>
      <div class="progress-bar"><div class="progress-fill" id="spell-progress"></div></div>
    </div>
  </div>

  <!-- Quiz Mode -->
  <div id="mode-quiz" style="display:none">
    <div class="card">
      <h2>çœ‹è‹±æ–‡ï¼Œé€‰ä¸­æ–‡ ğŸ¯</h2>
      <div class="quiz-word" id="quiz-word"></div>
      <div class="options" id="quiz-options"></div>
      <div class="feedback" id="quiz-feedback"></div>
      <div style="margin-top:12px">
        <button class="btn btn-success" id="quiz-next" onclick="nextQuiz()" style="display:none">ä¸‹ä¸€é¢˜ â†’</button>
      </div>
      <div class="progress-bar"><div class="progress-fill" id="quiz-progress"></div></div>
    </div>
  </div>

  <!-- Word List -->
  <div id="mode-list" style="display:none">
    <div class="card">
      <h2>ğŸ“‹ è¯æ±‡è¡¨</h2>
      <div class="filter-tabs">
        <div class="filter-tab active" onclick="filterList('all')">å…¨éƒ¨</div>
        <div class="filter-tab" onclick="filterList('new')">ğŸ†• å¾…å­¦ä¹ </div>
        <div class="filter-tab" onclick="filterList('learning')">ğŸ“ å­¦ä¹ ä¸­</div>
        <div class="filter-tab" onclick="filterList('mastered')">âœ… å·²æŒæ¡</div>
      </div>
      <div class="word-list" id="word-list"></div>
      <div class="reset-section">
        <button class="btn btn-danger btn-small" onclick="resetProgress()">ğŸ”„ é‡ç½®æ‰€æœ‰è¿›åº¦</button>
      </div>
    </div>
  </div>
</div>

<script src="vocab.js"></script>
<script>
// === State ===
const STORAGE_KEY = 'naplan-vocab-v1';
let state = loadState();
let currentWord = null;
let currentMode = 'spell';
let hintLevel = 0;
let quizAnswered = false;
let listFilter = 'all';

// Word state: { spellOk: number, quizOk: number, attempts: number, lastSeen: number }
// mastered = spellOk >= 2 AND quizOk >= 2
// learning = any attempts but not mastered
// new = no attempts

function loadState() {
  try {
    const s = JSON.parse(localStorage.getItem(STORAGE_KEY));
    return s || {};
  } catch { return {}; }
}

function saveState() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}

function getWordState(w) {
  if (!state[w]) state[w] = { spellOk: 0, quizOk: 0, attempts: 0, lastSeen: 0 };
  return state[w];
}

function getStatus(w) {
  const s = getWordState(w);
  if (s.spellOk >= 2 && s.quizOk >= 2) return 'mastered';
  if (s.attempts > 0) return 'learning';
  return 'new';
}

function getCounts() {
  let mastered = 0, learning = 0, neww = 0;
  for (const v of VOCAB) {
    const st = getStatus(v.w);
    if (st === 'mastered') mastered++;
    else if (st === 'learning') learning++;
    else neww++;
  }
  return { mastered, learning, new: neww, total: VOCAB.length };
}

function updateStats() {
  const c = getCounts();
  document.getElementById('s-mastered').textContent = c.mastered;
  document.getElementById('s-learning').textContent = c.learning;
  document.getElementById('s-new').textContent = c.new;
  document.getElementById('s-total').textContent = c.total;
  
  const pct = c.total > 0 ? (c.mastered / c.total * 100) : 0;
  document.getElementById('spell-progress').style.width = pct + '%';
  document.getElementById('quiz-progress').style.width = pct + '%';
}

// === Word Selection (spaced repetition) ===
function pickWord() {
  // Priority: learning > new > mastered
  // Within each: least recently seen first, with some randomness
  const now = Date.now();
  const candidates = [];
  
  for (const v of VOCAB) {
    const s = getWordState(v.w);
    const status = getStatus(v.w);
    let priority;
    if (status === 'learning') priority = 0; // highest
    else if (status === 'new') priority = 1;
    else priority = 2; // mastered - skip mostly
    
    if (status === 'mastered') continue; // don't show mastered words
    
    const timeSince = now - (s.lastSeen || 0);
    candidates.push({ vocab: v, priority, timeSince, attempts: s.attempts });
  }
  
  if (candidates.length === 0) {
    // All mastered! Show a random one for review
    return VOCAB[Math.floor(Math.random() * VOCAB.length)];
  }
  
  // Sort: priority first, then by time since last seen (longer = better)
  candidates.sort((a, b) => {
    if (a.priority !== b.priority) return a.priority - b.priority;
    return b.timeSince - a.timeSince;
  });
  
  // Pick from top 5 with randomness
  const pool = candidates.slice(0, Math.min(5, candidates.length));
  return pool[Math.floor(Math.random() * pool.length)].vocab;
}

// === Spelling Mode ===
function loadSpellWord() {
  currentWord = pickWord();
  hintLevel = 0;
  document.getElementById('spell-chinese').textContent = currentWord.m;
  document.getElementById('spell-hint').textContent = '';
  document.getElementById('spell-input').value = '';
  document.getElementById('spell-input').className = '';
  document.getElementById('spell-feedback').textContent = '';
  document.getElementById('spell-feedback').className = 'feedback';
  document.getElementById('spell-reveal').innerHTML = '';
  document.getElementById('spell-input').focus();
}

function checkSpelling() {
  const input = document.getElementById('spell-input').value.trim().toLowerCase();
  const correct = currentWord.w.toLowerCase();
  const ws = getWordState(currentWord.w);
  ws.attempts++;
  ws.lastSeen = Date.now();
  
  if (input === correct) {
    ws.spellOk++;
    document.getElementById('spell-input').className = 'correct';
    document.getElementById('spell-feedback').textContent = 'âœ… æ­£ç¡®ï¼å¤ªæ£’äº†ï¼';
    document.getElementById('spell-feedback').className = 'feedback correct';
    saveState();
    updateStats();
    setTimeout(() => loadSpellWord(), 1200);
  } else {
    ws.spellOk = Math.max(0, ws.spellOk - 1);
    document.getElementById('spell-input').className = 'wrong';
    document.getElementById('spell-feedback').textContent = 'âŒ å†è¯•ä¸€æ¬¡ï¼';
    document.getElementById('spell-feedback').className = 'feedback wrong';
    saveState();
    updateStats();
  }
}

function showHint() {
  if (!currentWord) return;
  hintLevel++;
  const w = currentWord.w;
  let hint = '';
  
  if (hintLevel === 1) {
    // Show first and last letter + length
    hint = w[0] + ' _ '.repeat(w.length - 2) + w[w.length - 1] + `  (${w.length}ä¸ªå­—æ¯)`;
  } else if (hintLevel === 2) {
    // Show every other letter
    hint = w.split('').map((c, i) => i % 2 === 0 ? c : '_').join(' ');
  } else {
    // Show all but one
    const hide = Math.floor(Math.random() * (w.length - 2)) + 1;
    hint = w.split('').map((c, i) => i === hide ? '_' : c).join(' ');
  }
  
  document.getElementById('spell-hint').textContent = hint;
}

function revealAnswer() {
  if (!currentWord) return;
  document.getElementById('spell-reveal').innerHTML = `<span class="reveal-word">${currentWord.w}</span>`;
  const ws = getWordState(currentWord.w);
  ws.spellOk = Math.max(0, ws.spellOk - 1);
  ws.attempts++;
  ws.lastSeen = Date.now();
  saveState();
  updateStats();
}

function nextWord() {
  loadSpellWord();
}

// === Quiz Mode ===
function loadQuiz() {
  currentWord = pickWord();
  quizAnswered = false;
  document.getElementById('quiz-word').textContent = currentWord.w;
  document.getElementById('quiz-feedback').textContent = '';
  document.getElementById('quiz-feedback').className = 'feedback';
  document.getElementById('quiz-next').style.display = 'none';
  
  // Generate 4 options (1 correct + 3 random)
  const correctMeaning = currentWord.m;
  const wrongMeanings = [];
  const pool = VOCAB.filter(v => v.w !== currentWord.w);
  
  while (wrongMeanings.length < 3 && pool.length > 0) {
    const idx = Math.floor(Math.random() * pool.length);
    const m = pool[idx].m;
    if (!wrongMeanings.includes(m) && m !== correctMeaning) {
      wrongMeanings.push(m);
    }
    pool.splice(idx, 1);
  }
  
  const options = [correctMeaning, ...wrongMeanings];
  // Shuffle
  for (let i = options.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [options[i], options[j]] = [options[j], options[i]];
  }
  
  const container = document.getElementById('quiz-options');
  container.innerHTML = '';
  options.forEach(opt => {
    const btn = document.createElement('div');
    btn.className = 'option';
    btn.textContent = opt;
    btn.onclick = () => selectOption(btn, opt, correctMeaning);
    container.appendChild(btn);
  });
}

function selectOption(btn, selected, correct) {
  if (quizAnswered) return;
  quizAnswered = true;
  
  const ws = getWordState(currentWord.w);
  ws.attempts++;
  ws.lastSeen = Date.now();
  
  // Disable all options
  document.querySelectorAll('.option').forEach(o => o.classList.add('disabled'));
  
  if (selected === correct) {
    ws.quizOk++;
    btn.classList.add('correct');
    document.getElementById('quiz-feedback').textContent = 'âœ… æ­£ç¡®ï¼';
    document.getElementById('quiz-feedback').className = 'feedback correct';
  } else {
    ws.quizOk = Math.max(0, ws.quizOk - 1);
    btn.classList.add('wrong');
    // Highlight correct answer
    document.querySelectorAll('.option').forEach(o => {
      if (o.textContent === correct) o.classList.add('correct');
    });
    document.getElementById('quiz-feedback').textContent = `âŒ æ­£ç¡®ç­”æ¡ˆ: ${correct}`;
    document.getElementById('quiz-feedback').className = 'feedback wrong';
  }
  
  saveState();
  updateStats();
  document.getElementById('quiz-next').style.display = 'inline-block';
}

function nextQuiz() {
  loadQuiz();
}

// === Word List ===
function renderList() {
  const container = document.getElementById('word-list');
  const sorted = [...VOCAB].sort((a, b) => a.w.localeCompare(b.w));
  
  let html = '';
  for (const v of sorted) {
    const status = getStatus(v.w);
    if (listFilter !== 'all' && status !== listFilter) continue;
    
    let badgeClass, badgeText;
    if (status === 'mastered') { badgeClass = 'badge-mastered'; badgeText = 'âœ… æŒæ¡'; }
    else if (status === 'learning') { badgeClass = 'badge-learning'; badgeText = 'ğŸ“ å­¦ä¹ ä¸­'; }
    else { badgeClass = 'badge-new'; badgeText = 'ğŸ†• æ–°è¯'; }
    
    html += `<div class="word-item">
      <span><span class="eng">${v.w}</span> <span class="chn">${v.m}</span></span>
      <span class="badge ${badgeClass}">${badgeText}</span>
    </div>`;
  }
  
  if (!html) html = '<div style="padding:20px;text-align:center;color:var(--muted)">æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„å•è¯</div>';
  container.innerHTML = html;
}

function filterList(filter) {
  listFilter = filter;
  document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
  event.target.classList.add('active');
  renderList();
}

function resetProgress() {
  if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰å­¦ä¹ è¿›åº¦å—ï¼Ÿè¿™å°†æ¸…é™¤æ‰€æœ‰è®°å½•ï¼')) {
    state = {};
    saveState();
    updateStats();
    renderList();
    if (currentMode === 'spell') loadSpellWord();
    else if (currentMode === 'quiz') loadQuiz();
  }
}

// === Mode Switch ===
function switchMode(mode) {
  currentMode = mode;
  document.querySelectorAll('.nav button').forEach(b => b.classList.remove('active'));
  event.target.classList.add('active');
  
  document.getElementById('mode-spell').style.display = mode === 'spell' ? 'block' : 'none';
  document.getElementById('mode-quiz').style.display = mode === 'quiz' ? 'block' : 'none';
  document.getElementById('mode-list').style.display = mode === 'list' ? 'block' : 'none';
  
  if (mode === 'spell') loadSpellWord();
  else if (mode === 'quiz') loadQuiz();
  else renderList();
}

// === Keyboard ===
document.addEventListener('keydown', e => {
  if (currentMode === 'spell' && e.key === 'Enter') {
    checkSpelling();
  }
});

// === Init ===
updateStats();
loadSpellWord();
</script>
</body>
</html>
